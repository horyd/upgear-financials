{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 5169c0d19fed0d155420","webpack:///external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"_\",\"root\":\"_\"}","webpack:///./src/index.js","webpack:///./src/amortisation.js","webpack:///./src/depreciation.js","webpack:///./src/feeComponents.js"],"names":["amortisation","depreciation","feeComponents","from","to","startingMonth","term","costOfFunds","distributionBase","PVOfValueAtTerm","PVDifference","longDistribution","flatten","Array","Math","ceil","fill","distributionCoefficientsAreValid","every","isNumber","max","min","Error","distributionBaseIsValid","length","v","i","sum","slice","exactDistribution","ratePlusOne","basePayment","map","k","pow","payments","reduce","amort","pmt","push","last","balances","a","rrp","rv","depreciationPower","operatingLife","writeOffMonths","age","depnInWriteOffPeriod","byMonth","y","capitalisedOriginationFee","fee","rate","capitalisedFutureDisposalFee","disposalSchedule","payment","accumulation","originationSchedule"],"mappings":"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","file":"library.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"library\", [\"_\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"library\"] = factory(require(\"lodash\"));\n\telse\n\t\troot[\"library\"] = factory(root[\"_\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_0__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5169c0d19fed0d155420","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"_\",\"root\":\"_\"}\n// module id = 0\n// module chunks = 0","import amortisation from './amortisation.js';\nimport depreciation from './depreciation.js';\nimport feeComponents from './feeComponents.js';\nexport { amortisation, depreciation, feeComponents };\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import _ from 'lodash';\n\nexport default function (\n  from,\n  to,\n  startingMonth,\n  term,\n  costOfFunds,\n  distributionBase = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]\n) {\n  const PVOfValueAtTerm = to / (1 + costOfFunds / 12) ** (term);\n  const PVDifference = from - PVOfValueAtTerm;\n\n  const longDistribution = _.flatten(Array(Math.ceil(term / 12) + 1).fill(distributionBase));\n  const distributionCoefficientsAreValid = distributionBase.every(_.isNumber) &&\n    _.max(distributionBase) === 1 &&\n    _.min(distributionBase) >= 0;\n\n  if (!distributionCoefficientsAreValid) {\n    throw new Error(`\n      The distribution array provided has invalid entries\n    `);\n  }\n\n  const distributionBaseIsValid = Array.from({ length: 12 }, (v, i) => i).every(i => (\n    _.sum(longDistribution.slice(i, i + 6)) >= 3 &&\n    _.sum(longDistribution.slice(i, i + 12)) >= 9\n  ));\n\n  if (!distributionBaseIsValid) {\n    throw new Error(`\n      You have too many months with reduced payments, or they are too bunched\n      together. Please edit your payment schedule.\n    `);\n  }\n\n  const exactDistribution = longDistribution.slice(startingMonth, startingMonth + term);\n\n  exactDistribution[0] = 1; // must pay the full payment on the originating month\n  const ratePlusOne = 1 + costOfFunds / 12;\n  const basePayment = PVDifference / (_.sum(exactDistribution\n    .map((k, i) => k / Math.pow(ratePlusOne, i))));\n  const payments = exactDistribution.map(k => (k * basePayment));\n  const amortisation = payments.reduce((amort, pmt, i) => {\n    if (i === 0) {\n      amort.push(from - pmt);\n    } else {\n      amort.push(_.last(amort) * ratePlusOne - pmt);\n    }\n    return amort;\n  }, []);\n  const balances = amortisation.map((a, i) => a + payments[i]);\n\n  return {\n    balances,\n    payments,\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/amortisation.js","export default (rrp, rv, depreciationPower, operatingLife, writeOffMonths, age = 0) => {\n  const depnInWriteOffPeriod = rv / writeOffMonths;\n\n  // linear\n  // const k = 2 * ((rrp - rv) - (rv / writeOffMonths * (operatingLife - age))) / (operatingLife - age)**2;\n  // parabolic\n  // const k = 3 * ((rrp - rv) - (rv / writeOffMonths * (operatingLife - age))) / (operatingLife - age)**3;\n  // n-ic\n  const k = depreciationPower * (\n    (rrp - rv) - (depnInWriteOffPeriod * (operatingLife))\n  ) / (operatingLife) ** depreciationPower;\n\n  const byMonth = Array.from({\n    length: (operatingLife + writeOffMonths + 1),\n  }, (v, i) => {\n    if (i === 0) return rrp;\n    if (i <= operatingLife) {\n      // linear\n      // const y = k/2 * ((operatingLife - age)**2 - (i - (operatingLife - age))**2) + depnInWriteOffPeriod * i;\n      // parabolic\n      // const y = k/3 * ((operatingLife - age)**3 + (i - (operatingLife - age))**3) + depnInWriteOffPeriod * i;\n      // n-ic\n      const y = (k / depreciationPower) * (\n        (operatingLife) ** depreciationPower - (i - (operatingLife)) ** depreciationPower\n      ) + depnInWriteOffPeriod * i;\n\n      return rrp - y;\n    }\n    return rv - (depnInWriteOffPeriod * (i - operatingLife));\n  });\n\n  return byMonth.slice(age);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/depreciation.js","import _ from 'lodash';\n\nfunction capitalisedOriginationFee(fee, term, rate) {\n  return (rate / 12 * fee) / (1 - (1 + rate / 12) ** -term) * (1 / (1 + rate / 12));\n}\n\nfunction capitalisedFutureDisposalFee(fee, term, rate) {\n  return (fee * rate / 12) * (1 / (((1 + rate / 12) ** term) - 1)) * (1 / (1 + rate / 12));\n}\n\nexport default {\n  disposalSchedule: function disposalSchedule(fee, term, rate) {\n    const ratePlusOne = 1 + rate / 12;\n    const payment = capitalisedFutureDisposalFee(fee, term, rate);\n    const accumulation = Array.from({ length: term }, () => payment).reduce((amort, pmt, i) => {\n      if (i === 0) {\n        amort.push(pmt);\n      } else {\n        amort.push(_.last(amort) * ratePlusOne + pmt);\n      }\n      return amort;\n    }, []);\n    const balances = accumulation.map((a, i) => a - payment);\n\n    return {\n      balances: [...balances, fee],\n      payment,\n    };\n  },\n  originationSchedule: function originationSchedule(fee, term, rate) {\n    const ratePlusOne = 1 + rate / 12;\n    const payment = capitalisedOriginationFee(fee, term, rate);\n    const amortisation = Array.from({ length: term }, () => payment).reduce((amort, pmt, i) => {\n      if (i === 0) {\n        amort.push(fee - pmt);\n      } else {\n        amort.push(_.last(amort) * ratePlusOne - pmt);\n      }\n      return amort;\n    }, []);\n    const balances = amortisation.map((a, i) => a + payment);\n\n    return {\n      balances: [...balances, 0],\n      payment,\n    };\n  },\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/feeComponents.js"],"sourceRoot":""}